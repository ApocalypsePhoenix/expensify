<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - EXPEN$IFY</title>
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div class="wrapper">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <img src="/images/expensifylogo.png" alt="EXPEN$IFY" class="logo-img">
        </div>
        <ul>
            <li><a th:href="@{/dashboard}" class="active">Dashboard</a></li>
            <li><a th:href="@{/transactions}">Transactions</a></li>
            <li><a th:href="@{/bills}">Bills</a></li>
            <li><a th:href="@{/budgets}">Budgets</a></li>
            <li><a th:href="@{/reports}">Reports</a></li>
            <li><a th:href="@{/users/settings}">Settings</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="content">
        <header>
            <h1>Welcome back, <span th:text="${user.name}">User</span>!</h1>
            <p class="subheading">Here is what's happening with your money today.</p>
        </header>

        <!-- Stats Overview Row -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon income-bg"><i class="fas fa-wallet"></i></div>
                <div class="stat-details">
                    <p class="stat-label">Total Balance</p>
                    <h2 class="stat-value" th:text="${currencySymbol + ' ' + #numbers.formatDecimal(balance, 1, 'COMMA', 2, 'POINT')}">RM 0.00</h2>
                    <p class="stat-change" th:classappend="${balance >= 0} ? 'positive' : 'negative'"
                       th:text="${balance >= 0 ? 'Account in Surplus' : 'Account in Deficit'}">Status</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon expense-bg"><i class="fas fa-credit-card"></i></div>
                <div class="stat-details">
                    <p class="stat-label">Monthly Expenses</p>
                    <h2 class="stat-value" th:text="${currencySymbol + ' ' + #numbers.formatDecimal(monthlyExpenses, 1, 'COMMA', 2, 'POINT')}">RM 0.00</h2>
                    <p class="stat-change muted" th:text="${#temporals.format(#temporals.createNow(), 'MMMM yyyy')}">Month</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon budget-bg"><i class="fas fa-chart-pie"></i></div>
                <div class="stat-details">
                    <p class="stat-label">Budget Progress</p>
                    <h2 class="stat-value" th:text="${budgetStatusText}">0% Used</h2>
                    <div class="mini-progress">
                        <div class="mini-bar" th:style="'width: ' + ${budgetPercent} + '%'"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Dashboard Widgets -->
        <div class="dashboard-widgets">
            <!-- Recent Transactions Widget -->
            <section class="widget recent-activity">
                <div class="widget-header">
                    <h3>Recent Transactions</h3>
                    <a th:href="@{/transactions}" class="btn-text">View All</a>
                </div>
                <div class="activity-list">
                    <div class="activity-item" th:each="tx : ${recentTransactions}">
                        <div class="item-icon">
                            <i th:class="${tx.transactionType == 'Income' ? 'fas fa-money-bill-wave' : 'fas fa-shopping-cart'}"></i>
                        </div>
                        <div class="item-info">
                            <p class="item-title" th:text="${tx.description}">Transaction</p>
                            <p class="item-date" th:text="${tx.date}">Date</p>
                        </div>
                        <p class="item-amount"
                           th:classappend="${tx.transactionType == 'Income' ? 'income' : 'expense'}"
                           th:text="${(tx.transactionType == 'Income' ? '+' : '-') + currencySymbol + ' ' + tx.amount}">
                            Amount
                        </p>
                    </div>
                    <p th:if="${recentTransactions.empty}" class="subheading">No recent activity.</p>
                </div>
            </section>

            <!-- Upcoming Bills Widget -->
            <section class="widget upcoming-bills">
                <div class="widget-header">
                    <h3>Upcoming Bills</h3>
                    <a th:href="@{/bills}" class="btn-text">Manage</a>
                </div>
                <div class="bill-mini-list">
                    <div class="bill-mini-card" th:each="bill : ${upcomingBills}"
                         th:classappend="${bill.dueDate.isBefore(#temporals.createToday().plusDays(3))} ? 'urgent' : ''">
                        <div class="bill-info">
                            <p class="bill-name" th:text="${bill.name}">Bill Name</p>
                            <p class="bill-due" th:text="'Due: ' + ${bill.dueDate}">Due Date</p>
                        </div>
                        <p class="bill-amount" th:text="${currencySymbol + ' ' + bill.amount}">Amount</p>
                    </div>
                    <p th:if="${upcomingBills.empty}" class="subheading">No upcoming bills.</p>
                </div>
                <div class="quick-action">
                    <button class="btn-outline" onclick="location.href='/bills/add'">+ Add New Reminder</button>
                </div>
            </section>
        </div>
    </div>
</div>

</body>
</html>